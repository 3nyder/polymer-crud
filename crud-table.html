<!--
An sortable, filtrable data table from api url.

Example:

    <crud-table></crud-table>

Example:
    <crud-table
      url="/api/bears"
      model="bearModel"
      actions="edit,delete"
    >
    </crud-table>



@demo demo/index.html
@hero hero.svg
-->
<dom-module id="crud-table" attributes="model setname">
  <template>
    <style include="shared-styles"></style>
    <style>
      .table-container {
        height: 300px;
        overflow-y: auto;
      }
      table {
        width: 100%;
        max-width: 100%;
        background-color: transparent;
        border-collapse: collapse;
        border-spacing: 0;
      }
      th {
        text-align: left;
        font-weight: 500;
        font-size: 12px;
        color: var(--secondary-text-color);
        padding: 8px;
      }
      td {
        font-size: 12px;
        color: var(--primary-text-color);
        padding: 0 8px;
        line-height: 35px;
      }
      tr:hover td {
         background: var(--paper-indigo-50);
      }
    </style>
    <iron-ajax auto
        url="http://172.16.52.85:8081/api/bears"
        handle-as="json"
        last-response="{{ajaxResponse}}"></iron-ajax>


    <div class="table-container">
    <input value="{{filterText::input}}" placeholder="filter">
      <table>
        <thead>
        <tr>
        <!-- Columns name -->
          <template is="dom-repeat" items="{{columns}}">
            <th>{{item}}</th>
          </template>
          <template is="dom-if" if="{{hasActions}}">
            <th>Actions</th>
          </template>
        </tr>
        </thead>
        <tbody>


          <template is="dom-repeat" items="[[ajaxResponse]]">
            <div class="horizontal-section">
              <p>{{item.name}}</p>
            </div>
          </template>

        </tbody>
      </table>
    </div>

  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'crud-table',

        properties: {
          model: {
            type: Object,
          },
          /* Get the column names from the model */
          colums : {
            type : Array
          },
          /*  fetched data from the columns to show and id */
          fetchedData : {
            type : Object
          },
          actions :  {
            type : String,
            value : "edit delete"
          },
          hasActions : {
            type : Boolean,
            value : true
          },

        /**
         * Sometimes api response seems like response.instance
         *
         * @param {string} the set name of the api response, 
         * if empty try to use them as a array of instances.
         */
          setname : {
            type :  String,
          }

        },

        ready :  function () {
          this.actions = this.getActions
          this.columns = this.getColumnsName();
          /* mapping properties of the data model into an iterable array*/
        },

        getColumnsName : function () {
          var model = this.model;
          return model.map(function(attribute) {
           if(attribute.hidden) {}
           else if (attribute.label) {
              return attribute.label;
           } 
           return attribute.key;
         });
        },
        getColumns : function () {
          var model = this.model;
          return model.map(function(attribute){
            if (attribute.hidden) {}
            else {
              return attribute.key;
            } 
          });
        },
        getValues :  function (data) {
          return [{name:'ss'}]
        },
        /* fetch the data from the api */
        fetchData : function (e) {
          var data = e.detail.xhr.response;
          var columns = this.getColumns();
          var values = [];

          data.forEach(function(element) {
            columns.forEach(function(column){
              if (element[column]) {
                values.push(element[column])
              } else {
                values.push('');
              }
            });
          });
          var z = document.querySelector('results');
          return values;
        }, 
        someFilter :  function (e) {}
      });
    })();
  </script>

</dom-module>